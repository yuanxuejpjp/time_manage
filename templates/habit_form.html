{% extends "base.html" %}

{% block title %}ç¼–è¾‘ä¹ æƒ¯ - {{ habit.title }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0"><i class="bi bi-pencil"></i> ç¼–è¾‘ä¹ æƒ¯</h4>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="title" class="form-label">ä¹ æƒ¯åç§° <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="title" name="title"
                               value="{{ habit.title }}" required>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="category" class="form-label">åˆ†ç±»</label>
                            <input type="text" class="form-control" id="category" name="category" list="habit-categories"
                                   value="{{ habit.category }}">
                            <datalist id="habit-categories">
                                <option value="è¿åŠ¨">
                                <option value="å­¦ä¹ ">
                                <option value="é˜…è¯»">
                                <option value="å†¥æƒ³">
                                <option value="æ—©èµ·">
                                <option value="å¥åº·é¥®é£Ÿ">
                                <option value="å…¶ä»–">
                            </datalist>
                        </div>
                        <div class="col-md-6">
                            <label for="icon" class="form-label">å›¾æ ‡</label>
                            <select class="form-select" id="icon" name="icon">
                                <option value="star" {% if habit.icon == 'star' %}selected{% endif %}>â­ æ˜Ÿæ˜Ÿ</option>
                                <option value="heart" {% if habit.icon == 'heart' %}selected{% endif %}>â¤ï¸ çˆ±å¿ƒ</option>
                                <option value="fire" {% if habit.icon == 'fire' %}selected{% endif %}>ğŸ”¥ ç«ç„°</option>
                                <option value="lightning" {% if habit.icon == 'lightning' %}selected{% endif %}>âš¡ é—ªç”µ</option>
                                <option value="sun" {% if habit.icon == 'sun' %}selected{% endif %}>â˜€ï¸ å¤ªé˜³</option>
                                <option value="moon" {% if habit.icon == 'moon' %}selected{% endif %}>ğŸŒ™ æœˆäº®</option>
                                <option value="book" {% if habit.icon == 'book' %}selected{% endif %}>ğŸ“š ä¹¦æœ¬</option>
                                <option value="bicycle" {% if habit.icon == 'bicycle' %}selected{% endif %}>ğŸš´ è‡ªè¡Œè½¦</option>
                                <option value="droplet" {% if habit.icon == 'droplet' %}selected{% endif %}>ğŸ’§ æ°´æ»´</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label">æè¿°</label>
                        <textarea class="form-control" id="description" name="description" rows="2">{{ habit.description or '' }}</textarea>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="frequency" class="form-label">é¢‘ç‡</label>
                            <select class="form-select" id="frequency" name="frequency" onchange="toggleWeeklyDays()">
                                <option value="daily" {% if habit.frequency == 'daily' %}selected{% endif %}>æ¯å¤©</option>
                                <option value="weekdays" {% if habit.frequency == 'weekdays' %}selected{% endif %}>å·¥ä½œæ—¥</option>
                                <option value="weekends" {% if habit.frequency == 'weekends' %}selected{% endif %}>å‘¨æœ«</option>
                                <option value="weekly" {% if habit.frequency == 'weekly' %}selected{% endif %}>æ¯å‘¨æŒ‡å®šå¤©</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="target_value" class="form-label">ç›®æ ‡å€¼</label>
                            <input type="number" class="form-control" id="target_value" name="target_value"
                                   value="{{ habit.target_value }}" step="0.1" min="0.1">
                        </div>
                        <div class="col-md-3">
                            <label for="target_unit" class="form-label">å•ä½</label>
                            <input type="text" class="form-control" id="target_unit" name="target_unit" value="{{ habit.target_unit }}"
                                   list="unit-list">
                            <datalist id="unit-list">
                                <option value="æ¬¡">
                                <option value="åˆ†é’Ÿ">
                                <option value="å°æ—¶">
                                <option value="é¡µ">
                                <option value="ç« ">
                                <option value="å…¬é‡Œ">
                            </datalist>
                        </div>
                    </div>

                    <div id="weekly-days-container" class="mb-3" style="display: {% if habit.frequency == 'weekly' %}block{% else %}none{% endif %};">
                        <label class="form-label">é€‰æ‹©æ˜ŸæœŸ</label>
                        <div class="d-flex gap-2 flex-wrap">
                            {% set days = habit.target_days.split(',') if habit.target_days else [] %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="target_days" value="0" id="day0"
                                       {% if '0' in days %}checked{% endif %}>
                                <label class="form-check-label" for="day0">å‘¨ä¸€</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="target_days" value="1" id="day1"
                                       {% if '1' in days %}checked{% endif %}>
                                <label class="form-check-label" for="day1">å‘¨äºŒ</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="target_days" value="2" id="day2"
                                       {% if '2' in days %}checked{% endif %}>
                                <label class="form-check-label" for="day2">å‘¨ä¸‰</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="target_days" value="3" id="day3"
                                       {% if '3' in days %}checked{% endif %}>
                                <label class="form-check-label" for="day3">å‘¨å››</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="target_days" value="4" id="day4"
                                       {% if '4' in days %}checked{% endif %}>
                                <label class="form-check-label" for="day4">å‘¨äº”</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="target_days" value="5" id="day5"
                                       {% if '5' in days %}checked{% endif %}>
                                <label class="form-check-label" for="day5">å‘¨å…­</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="target_days" value="6" id="day6"
                                       {% if '6' in days %}checked{% endif %}>
                                <label class="form-check-label" for="day6">å‘¨æ—¥</label>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="reminder_time" class="form-label">æ¯æ—¥æé†’æ—¶é—´</label>
                        <input type="time" class="form-control" id="reminder_time" name="reminder_time"
                               value="{{ habit.reminder_time|time_filter if habit.reminder_time else '' }}">
                        <small class="text-muted">æ¯å¤©åœ¨è¿™ä¸ªæ—¶é—´æé†’ä½ å®Œæˆä¹ æƒ¯</small>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save"></i> ä¿å­˜
                        </button>
                        <a href="{{ url_for('habits.list_habits') }}" class="btn btn-outline-secondary">å–æ¶ˆ</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function toggleWeeklyDays() {
    const frequency = document.getElementById('frequency').value;
    const weeklyDaysContainer = document.getElementById('weekly-days-container');
    weeklyDaysContainer.style.display = frequency === 'weekly' ? 'block' : 'none';
}
</script>
{% endblock %}
