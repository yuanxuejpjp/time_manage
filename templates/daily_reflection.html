{% extends "base.html" %}

{% block title %}每日复盘 - 时间掌控者{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0"><i class="bi bi-journal-check"></i> 每日复盘</h4>
                <span class="text-muted">{{ reflection.reflection_date|date_filter if reflection else today|date_filter }}</span>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('reflection.save_reflection') }}">
                    <input type="hidden" name="reflection_date" value="{{ reflection.reflection_date if reflection else today }}">

                    <!-- 【1. 今日核心推进】 -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0"><span class="badge bg-primary me-2">1</span>今日核心推进</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="core_progress" class="form-label">内容</label>
                                <textarea class="form-control" id="core_progress" name="core_progress"
                                          rows="3" placeholder="今天最重要的推进是什么？">{{ reflection.core_progress if reflection else '' }}</textarea>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="is_long_term_value"
                                       name="is_long_term_value" {% if reflection and reflection.is_long_term_value %}checked{% endif %}>
                                <label class="form-check-label" for="is_long_term_value">
                                    是否产生长期价值
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- 【2. 深度工作】 -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0"><span class="badge bg-primary me-2">2</span>深度工作</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="deep_work_hours" class="form-label">深度工作时间（小时）</label>
                                <input type="number" class="form-control" id="deep_work_hours" name="deep_work_hours"
                                       value="{{ reflection.deep_work_hours if reflection else '' }}" step="0.5" min="0"
                                       placeholder="例如：3">
                            </div>
                            <div class="mb-3">
                                <label for="high_energy_period" class="form-label">高能区间</label>
                                <input type="text" class="form-control" id="high_energy_period" name="high_energy_period"
                                       value="{{ reflection.high_energy_period if reflection else '' }}"
                                       placeholder="例如：上午9:00-12:00">
                            </div>
                        </div>
                    </div>

                    <!-- 【3. 核心领悟】 -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0"><span class="badge bg-primary me-2">3</span>核心领悟</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="key_insight" class="form-label">今日关键认知</label>
                                <textarea class="form-control" id="key_insight" name="key_insight"
                                          rows="3" placeholder="今天有什么新的认识或发现？">{{ reflection.key_insight if reflection else '' }}</textarea>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="changed_judgment"
                                               name="changed_judgment" {% if reflection and reflection.changed_judgment %}checked{% endif %}>
                                        <label class="form-check-label" for="changed_judgment">
                                            是否改变原有判断
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="influences_future"
                                               name="influences_future" {% if reflection and reflection.influences_future %}checked{% endif %}>
                                        <label class="form-check-label" for="influences_future">
                                            未来是否影响决策
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 【4. 偏差分析】 -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0"><span class="badge bg-primary me-2">4</span>偏差分析</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="time_waste" class="form-label">今日最大时间浪费</label>
                                <textarea class="form-control" id="time_waste" name="time_waste"
                                          rows="2" placeholder="什么活动浪费了最多时间？">{{ reflection.time_waste if reflection else '' }}</textarea>
                            </div>
                            <div class="mb-3">
                                <label for="waste_reason" class="form-label">原因</label>
                                <textarea class="form-control" id="waste_reason" name="waste_reason"
                                          rows="2" placeholder="为什么会发生这种情况？">{{ reflection.waste_reason if reflection else '' }}</textarea>
                            </div>
                        </div>
                    </div>

                    <!-- 【5. 明日唯一关键任务（MIT）】 -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0"><span class="badge bg-success me-2">5</span>明日唯一关键任务（MIT）</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="tomorrow_mit" class="form-label">明天最重要的一件事</label>
                                <textarea class="form-control" id="tomorrow_mit" name="tomorrow_mit"
                                          rows="2" placeholder="无论发生什么，明天必须完成的任务是什么？">{{ reflection.tomorrow_mit if reflection else '' }}</textarea>
                                <small class="text-muted">MIT = Most Important Task，确保这件事完成后，这一天就没有白过</small>
                            </div>
                        </div>
                    </div>

                    <!-- 提交按钮 -->
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-save"></i> 保存复盘
                        </button>
                        <a href="{{ url_for('reflection.reflection_history') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-clock-history"></i> 历史记录
                        </a>
                        <a href="{{ url_for('reflection.reflection_stats') }}" class="btn btn-outline-info">
                            <i class="bi bi-graph-up"></i> 统计分析
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
