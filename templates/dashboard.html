{% extends "base.html" %}

{% block title %}ä»ªè¡¨ç›˜ - æ—¶é—´æŒæ§è€…{% endblock %}

{% block content %}
<style>
.love-card {
    border: none;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    transition: transform 0.3s, box-shadow 0.3s;
}
.love-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0,0,0,0.12);
}
.greeting-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 25px;
    padding: 30px;
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
}
.greeting-card::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    animation: float 6s ease-in-out infinite;
}
@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}
.emoji-bounce {
    animation: bounce 2s ease-in-out infinite;
    display: inline-block;
}
@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}
.progress-ring {
    transform: rotate(-90deg);
}
.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}
.motivational-quote {
    font-style: italic;
    color: #666;
    padding: 15px 20px;
    background: #f8f9fa;
    border-left: 4px solid #667eea;
    border-radius: 10px;
    margin-bottom: 20px;
}
.habit-card {
    border: none;
    border-radius: 15px;
    transition: all 0.3s;
}
.habit-card:hover {
    transform: scale(1.02);
}
.habit-card.checked {
    background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%) !important;
}
.schedule-item-cute {
    border-left: 4px solid;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 12px;
    background: #f8f9fa;
    transition: all 0.3s;
}
.schedule-item-cute:hover {
    background: white;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}
</style>

<!-- é—®å€™å¡ç‰‡ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="greeting-card">
            <div class="position-relative">
                <h2 class="mb-2">
                    <span class="emoji-bounce">âœ¨</span>
                    {{ greeting_message }}, {{ current_user.username }}!
                    <span class="emoji-bounce">âœ¨</span>
                </h2>
                <p class="mb-0 fs-5" style="opacity: 0.9;">{{ today|today_str }} Â· {{ daily_encouragement }}</p>
                <div class="mt-3">
                    <span style="font-size: 2rem;">{{ daily_emoji }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- æ¯æ—¥æ¿€åŠ± -->
<div class="row mb-4">
    <div class="col-12">
        <div class="motivational-quote">
            <i class="bi bi-quote"></i> {{ motivational_quote }} <i class="bi bi-quote"></i>
        </div>
    </div>
</div>

<!-- ä»Šæ—¥ç»Ÿè®¡å¡ç‰‡ -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card love-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
            <div class="card-body text-center">
                <div class="emoji-bounce mb-2">ğŸ¯</div>
                <h6 class="card-title text-white opacity-75">ä»Šæ—¥å®Œæˆ</h6>
                <div class="stat-number text-white">{{ today_progress }}%</div>
                <p class="mb-0"><small>{{ completed_today }}/{{ total_today }} é¡¹ä»»åŠ¡</small></p>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card love-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white;">
            <div class="card-body text-center">
                <div class="emoji-bounce mb-2">ğŸ”¥</div>
                <h6 class="card-title text-white opacity-75">ç´§æ€¥ä»»åŠ¡</h6>
                <div class="stat-number text-white">{{ urgent_tasks|length }}</div>
                <p class="mb-0"><small>å¾…å¤„ç†çš„é«˜ä¼˜å…ˆä»»åŠ¡</small></p>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card love-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
            <div class="card-body text-center">
                <div class="emoji-bounce mb-2">ğŸ“…</div>
                <h6 class="card-title text-white opacity-75">ä»Šæ—¥æ—¥ç¨‹</h6>
                <div class="stat-number text-white">{{ today_schedules|length }}</div>
                <p class="mb-0"><small>é¡¹è®¡åˆ’å®‰æ’</small></p>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card love-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white;">
            <div class="card-body text-center">
                <div class="emoji-bounce mb-2">â­</div>
                <h6 class="card-title text-white opacity-75">æˆ‘çš„ç§¯åˆ†</h6>
                <div class="stat-number text-white">{{ user_points }}</div>
                <p class="mb-0"><small><a href="{{ url_for('reflection.daily_reflection') }}" class="text-white">æ¯æ—¥å¤ç›˜ â†’</a></small></p>
            </div>
        </div>
    </div>
</div>

<!-- ä»Šæ—¥ä¹ æƒ¯æ‰“å¡ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card love-card">
            <div class="card-header d-flex justify-content-between align-items-center" style="background: transparent; border-bottom: 2px solid #f0f0f0;">
                <div>
                    <h5 class="mb-0"><span class="emoji-bounce">ğŸ’ª</span> ä»Šæ—¥ä¹ æƒ¯</h5>
                </div>
                <a href="{{ url_for('habits.list_habits') }}" class="btn btn-sm btn-outline-primary rounded-pill">ä¹ æƒ¯ä¸­å¿ƒ</a>
            </div>
            <div class="card-body">
                {% if today_habits %}
                    <div class="row">
                        {% for item in today_habits %}
                            <div class="col-md-4 col-sm-6 mb-3">
                                <div class="card habit-card h-100 {% if item.checked %}checked{% endif %}">
                                    <div class="card-body p-3">
                                        <div class="d-flex align-items-center">
                                            <div class="emoji-bounce me-2" style="font-size: 2rem;">
                                                {% if item.habit.icon == 'sun' %}â˜€ï¸
                                                {% elif item.habit.icon == 'moon' %}ğŸŒ™
                                                {% elif item.habit.icon == 'book' %}ğŸ“š
                                                {% elif item.habit.icon == 'droplet' %}ğŸ’§
                                                {% elif item.habit.icon == 'bicycle' %}ğŸš´
                                                {% elif item.habit.icon == 'music' %}ğŸµ
                                                {% elif item.habit.icon == 'palette' %}ğŸ¨
                                                {% elif item.habit.icon == 'code' %}ğŸ’»
                                                {% else %}âœ…{% endif %}
                                            </div>
                                            <div>
                                                <h6 class="mb-0">{{ item.habit.title }}</h6>
                                                <small class="text-muted">
                                                    {{ item.habit.target_value }}{{ item.habit.target_unit }}
                                                    Â· ğŸ”¥ <strong>{{ item.streak }}</strong> å¤©è¿ç»­
                                                </small>
                                            </div>
                                            {% if item.checked %}
                                                <div class="ms-auto">
                                                    <span class="badge rounded-pill" style="background: #28a745; font-size: 1.2rem;">
                                                        <i class="bi bi-check-circle"></i>
                                                    </span>
                                                </div>
                                            {% else %}
                                                <a href="{{ url_for('habits.checkin', habit_id=item.habit.id) }}"
                                                   class="btn btn-sm rounded-pill ms-auto" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                                                    æ‰“å¡ ğŸ’ª
                                                </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <div style="font-size: 3rem;">ğŸŒ±</div>
                        <p class="text-muted mt-2">è¿˜æ²¡æœ‰åˆ›å»ºä¹ æƒ¯ï¼Œå¼€å§‹åŸ¹å…»å¥½ä¹ æƒ¯å§ï¼</p>
                        <a href="{{ url_for('habits.list_habits') }}" class="btn btn-primary rounded-pill">åˆ›å»ºä¹ æƒ¯</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- ä»Šæ—¥æ—¥ç¨‹æ—¶é—´è½´ -->
    <div class="col-lg-6 mb-4">
        <div class="card love-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center" style="background: transparent; border-bottom: 2px solid #f0f0f0;">
                <div>
                    <h5 class="mb-0"><span class="emoji-bounce">ğŸ“‹</span> ä»Šæ—¥æ—¥ç¨‹</h5>
                </div>
                <a href="{{ url_for('schedule.view_schedule') }}" class="btn btn-sm btn-outline-primary rounded-pill">æŸ¥çœ‹å…¨éƒ¨</a>
            </div>
            <div class="card-body">
                {% if today_schedules %}
                    <div class="schedule-timeline">
                        {% for sched in today_schedules %}
                            <div class="schedule-item-cute" style="border-left-color: {% if sched.status == 'completed' %}#28a745{% elif sched.is_meeting %}#dc3545{% elif sched.status == 'partial' %}#ffc107{% else %}#6c757d{% endif %};">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div style="flex: 1;">
                                        <h6 class="mb-1">
                                            {% if sched.is_meeting %}
                                                <span class="badge me-1" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">ğŸ‘¥ ä¼šè®®</span>
                                            {% endif %}
                                            {{ sched.task_title }}
                                        </h6>
                                        <small class="text-muted">
                                            <i class="bi bi-clock"></i>
                                            {{ sched.start_time|time_filter }} - {{ sched.end_time|time_filter }}
                                            {% if sched.location %}
                                                | <i class="bi bi-geo-alt"></i> {{ sched.location }}
                                            {% endif %}
                                        </small>
                                        {% if sched.category and not sched.is_meeting %}
                                            <span class="badge bg-light text-dark ms-2">{{ sched.category }}</span>
                                        {% endif %}
                                    </div>
                                    <span class="badge rounded-pill" style="{% if sched.status == 'completed' %}background: #28a745;{% elif sched.status == 'partial' %}background: #ffc107;{% else %}background: #6c757d;{% endif %}">
                                        {% if sched.status == 'completed' %}âœ… å·²å®Œæˆ
                                        {% elif sched.status == 'partial' %}â³ è¿›è¡Œä¸­
                                        {% elif sched.status == 'cancelled' %}âŒ å·²å–æ¶ˆ
                                        {% else %}ğŸ“ å·²å®‰æ’{% endif %}
                                    </span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <div style="font-size: 4rem;">ğŸ“</div>
                        <p class="text-muted mt-3">ä»Šå¤©è¿˜æ²¡æœ‰æ—¥ç¨‹å®‰æ’</p>
                        <p class="text-muted small">è®© AI å¸®ä½ è§„åˆ’ç¾å¥½çš„ä¸€å¤©ï¼</p>
                        <a href="{{ url_for('schedule.view_schedule') }}" class="btn btn-primary rounded-pill mt-2" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
                            âœ¨ ç”Ÿæˆæ™ºèƒ½æ—¥ç¨‹
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- ç´§æ€¥ä»»åŠ¡ -->
    <div class="col-lg-6 mb-4">
        <div class="card love-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center" style="background: transparent; border-bottom: 2px solid #f0f0f0;">
                <div>
                    <h5 class="mb-0"><span class="emoji-bounce">ğŸš¨</span> ç´§æ€¥ä»»åŠ¡</h5>
                </div>
                <a href="{{ url_for('tasks.list_tasks') }}" class="btn btn-sm btn-outline-primary rounded-pill">æŸ¥çœ‹å…¨éƒ¨</a>
            </div>
            <div class="card-body">
                {% if urgent_tasks %}
                    <div class="list-group list-group-flush">
                        {% for task in urgent_tasks[:5] %}
                            <div class="list-group-item px-0" style="border: none; border-bottom: 1px solid #f0f0f0;">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1">{{ task.title }}</h6>
                                        <small class="text-muted">
                                            <i class="bi bi-tag"></i> {{ task.category }}
                                            {% if task.deadline %}
                                                | <i class="bi bi-calendar"></i> {{ task.deadline|date_filter }}
                                            {% endif %}
                                        </small>
                                    </div>
                                    <span class="badge rounded-pill" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">ğŸ”¥ é«˜ä¼˜å…ˆ</span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <div style="font-size: 4rem;">ğŸ‰</div>
                        <p class="text-success mt-3 fw-bold">å¤ªæ£’äº†ï¼æ²¡æœ‰ç´§æ€¥ä»»åŠ¡</p>
                        <p class="text-muted small">äº«å—ä½ çš„è‡ªç”±æ—¶é—´å§~</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- æœ€æ–°æ€»ç»“ -->
    <div class="col-lg-6 mb-4">
        <div class="card love-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center" style="background: transparent; border-bottom: 2px solid #f0f0f0;">
                <div>
                    <h5 class="mb-0"><span class="emoji-bounce">ğŸ“Š</span> æœ€æ–°æ€»ç»“</h5>
                </div>
                {% if latest_summary %}
                    <a href="{{ url_for('summary.view_summary', summary_id=latest_summary.id) }}" class="btn btn-sm btn-outline-primary rounded-pill">æŸ¥çœ‹è¯¦æƒ…</a>
                {% endif %}
            </div>
            <div class="card-body">
                {% if latest_summary %}
                    <h6 class="text-muted">
                        {{ latest_summary.summary_type|summary_type_filter }} Â·
                        {{ latest_summary.start_date|date_filter }} - {{ latest_summary.end_date|date_filter }}
                    </h6>
                    <div class="mt-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <small class="text-muted">å®Œæˆç‡</small>
                            <small class="fw-bold" style="color: #667eea;">{{ latest_summary.completion_rate }}%</small>
                        </div>
                        <div class="progress" style="height: 12px; border-radius: 10px; background: #f0f0f0;">
                            <div class="progress-bar rounded-pill" style="width: {{ latest_summary.completion_rate }}%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);">
                            </div>
                        </div>
                    </div>
                    {% if latest_summary.total_hours > 0 %}
                        <div class="mt-3">
                            <small class="text-muted">â±ï¸ å·¥ä½œæ—¶é•¿ï¼š<strong>{{ latest_summary.total_hours }}å°æ—¶</strong></small>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="text-center py-5">
                        <div style="font-size: 3rem;">ğŸ“”</div>
                        <p class="text-muted mt-3">è¿˜æ²¡æœ‰ç”Ÿæˆæ€»ç»“</p>
                        <a href="{{ url_for('summary.list_summaries') }}" class="btn btn-primary rounded-pill" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
                            ç”Ÿæˆæ€»ç»“
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- æ¯æ—¥å¤ç›˜å…¥å£ -->
    <div class="col-lg-6 mb-4">
        <div class="card love-card h-100" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);">
            <div class="card-body text-center d-flex flex-column justify-content-center">
                <div class="emoji-bounce mb-3" style="font-size: 4rem;">ğŸ“</div>
                <h4 class="mb-3">ä»Šæ—¥å¤ç›˜</h4>
                <p class="text-muted mb-4">è®°å½•ä»Šå¤©çš„æ”¶è·ä¸æ€è€ƒï¼Œ<br>è®©æ¯ä¸€å¤©éƒ½æœ‰æ„ä¹‰ âœ¨</p>
                <a href="{{ url_for('reflection.daily_reflection') }}" class="btn btn-dark rounded-pill px-4" style="border: none; padding: 12px 30px;">
                    å¼€å§‹å¤ç›˜ ğŸš€
                </a>
            </div>
        </div>
    </div>
</div>

<script>
// åŠ¨æ€é—®å€™å’Œæ¯æ—¥æ¿€åŠ±
const hour = new Date().getHours();
let greeting = '';
let dailyEncouragement = '';
let dailyEmoji = '';

if (hour < 6) {
    greeting = 'å¤œæ·±äº†';
    dailyEncouragement = 'æ³¨æ„ä¼‘æ¯ï¼Œèº«ä½“æœ€é‡è¦ ğŸ’¤';
    dailyEmoji = 'ğŸŒ™';
} else if (hour < 9) {
    greeting = 'æ—©ä¸Šå¥½';
    dailyEncouragement = 'ç¾å¥½çš„ä¸€å¤©å¼€å§‹äº†ï¼ŒåŠ æ²¹ï¼â˜€ï¸';
    dailyEmoji = 'ğŸŒ…';
} else if (hour < 12) {
    greeting = 'ä¸Šåˆå¥½';
    dailyEncouragement = 'ä¿æŒä¸“æ³¨ï¼Œä½ å¯ä»¥çš„ï¼ğŸ’ª';
    dailyEmoji = 'ğŸ“š';
} else if (hour < 14) {
    greeting = 'ä¸­åˆå¥½';
    dailyEncouragement = 'è®°å¾—ä¼‘æ¯å’Œåƒé¥­å“¦~ ğŸœ';
    dailyEmoji = 'â˜•';
} else if (hour < 18) {
    greeting = 'ä¸‹åˆå¥½';
    dailyEncouragement = 'ç»§ç»­åŠ æ²¹ï¼Œä½ å¾ˆæ£’ï¼ğŸŒŸ';
    dailyEmoji = 'ğŸ’«';
} else if (hour < 22) {
    greeting = 'æ™šä¸Šå¥½';
    dailyEncouragement = 'ä»Šå¤©è¾›è‹¦äº†ï¼Œå¥½å¥½æ”¾æ¾~ ğŸŒ™';
    dailyEmoji = 'ğŸ›‹ï¸';
} else {
    greeting = 'å¤œæ·±äº†';
    dailyEncouragement = 'æ—©ç‚¹ä¼‘æ¯ï¼Œæ˜å¤©è§ ğŸ˜´';
    dailyEmoji = 'ğŸŒœ';
}

// æ¯æ—¥æ¿€åŠ±è¯­å½•
const quotes = [
    "ç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨ã€‚ğŸ’ª",
    "æ¯ä¸€ä¸ªä¸æ›¾èµ·èˆçš„æ—¥å­ï¼Œéƒ½æ˜¯å¯¹ç”Ÿå‘½çš„è¾œè´Ÿã€‚âœ¨",
    "ä½ ä»Šå¤©çš„åŠªåŠ›ï¼Œæ˜¯å¹¸è¿çš„ä¼ç¬”ã€‚ğŸ€",
    "æ˜Ÿå…‰ä¸é—®èµ¶è·¯äººï¼Œæ—¶å…‰ä¸è´Ÿæœ‰å¿ƒäººã€‚â­",
    "ä¸ç§¯è·¬æ­¥ï¼Œæ— ä»¥è‡³åƒé‡Œã€‚ğŸ‘£",
    "åšæŒä¸‹å»ï¼Œä½ æƒ³è¦çš„éƒ½ä¼šæœ‰ã€‚ğŸ¯",
    "æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼ŒæˆåŠŸç¦»ä½ æ›´è¿‘ä¸€ç‚¹ã€‚ğŸ“ˆ",
    "ç›¸ä¿¡è‡ªå·±çš„åŠ›é‡ï¼Œä½ å¯ä»¥åšåˆ°çš„ï¼ğŸ’«"
];

const motivationalQuote = quotes[Math.floor(Math.random() * quotes.length)];

// ä¼ é€’æ•°æ®åˆ°æ¨¡æ¿ï¼ˆé€šè¿‡å…¨å±€å˜é‡ï¼‰
window.greetingMessage = greeting;
window.dailyEncouragement = dailyEncouragement;
window.dailyEmoji = dailyEmoji;
window.motivationalQuote = motivationalQuote;
</script>
{% endblock %}
